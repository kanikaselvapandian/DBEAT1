<!DOCTYPE html>
<html lang="en">
<!-- hi -->
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Profile</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="/DBEAT1/lendinsync/assets/img/favicon.jpg" rel="icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="/DBEAT1/lendinsync/assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="/DBEAT1/lendinsync/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="/DBEAT1/lendinsync/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="/DBEAT1/lendinsync/assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="/DBEAT1/lendinsync/assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="/DBEAT1/lendinsync/assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="/DBEAT1/lendinsync/assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Vue 3 -->
  <script src='https://cdn.jsdelivr.net/npm/vue@3.0.2/dist/vue.global.js'></script>

  <!-- Template Main CSS File -->
  <link href="/DBEAT1/lendinsync/assets/css/style.css" rel="stylesheet">

  <style>
    .card {
        background-color: #c0d0fa;
    }
    .card-deck-scroll {
        display: flex;
        flex-wrap: nowrap;
        overflow-x: auto;
        scrollbar-width: thin; /* Optional: Adjust scrollbar width */
        width: 100%; /* Ensures full width within the container */
    }
    .card {
        flex: 0 0 250px; /* Fixed width for each card */
        margin-right: 10px; /* Optional: Adjust the margin between cards */
    }
    .custom-width {
        max-width: 1000px; 
        margin: 0 auto; /* To center align the content */
    }
    body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        margin: 0;
        }

    main {
    flex: 1;
    }

    #footer {
        background-color: #f8f9fa; /* Replace with your preferred color */
        width: 100%;
        text-align: center;
        padding: 20px 0; /* Adjust the padding as needed */
        position: sticky;
        bottom: 0;
    }
</style>

  <!-- =======================================================
  * Template Name: OnePage
  * Updated: Sep 18 2023 with Bootstrap v5.3.2
  * Template URL: https://bootstrapmade.com/onepage-multipurpose-bootstrap-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="fixed-top">
    <div class="container d-flex align-items-center justify-content-between">
      <div>
        <img src="/DBEAT1/lendinsync/assets/img/favicon.jpg" width="50" height="50" style="display: inline-block;"><h1 class="logo" style="display: inline-block;"><a href="/home">LendInSync</a></h1>
      </div>

      <nav id="navbar" class="navbar">
        <ul>
          <li><a class="nav-link scrollto" href="/home">Home</a></li>
          <li><a class="nav-link scrollto" href="/wallet">Wallets</a></li>
          <li><a class="nav-link scrollto" href="/marketplace">Marketplace</a></li>
          <li><a class="nav-link scrollto" href="/my_loans">My Loans</a></li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Create Application
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="/loan/borrowing/">Create Borrow Application</a></li>
              <li><a class="dropdown-item" href="/loan/lending/">Create Lending Application</a></li>
            </ul>
          </li>
          <li><a class="nav-link scrollto active" href="/profile">Profile</a></li>
          <li><a class="nav-link scrollto"href="/" onclick="logout()">Logout</a></li>
        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav><!-- .navbar -->
    </div>
  </header><!-- End Header -->

  <!-- ======= Hero Section ======= -->
  <section id="hero" class="d-flex align-items-center">
    <div class="container position-relative" data-aos="fade-up" data-aos-delay="100">
      <div class="row justify-content-center">
        <div class="col-xl-7 col-lg-9 text-center">
          <h1>Profile</h1>
          <h2 id='ownName'>John Doe</h2>
          <p id='ownPhoneNo'></p>
        </div>
      </div>

      <div class="row icon-boxes custom-width">
        <div class="col-md-12 col-lg-6 d-flex align-items-stretch mb-3 mb-lg-0" data-aos="zoom-in" data-aos-delay="200">
          <div class="icon-box" style="width: 100%;">
            <h6 id='ownCustomerID' class="card-subtitle mb-2 text"></h6>
            <h6 id='ownNationality' class="card-subtitle mb-2 text"></h6>
            <h6 id='ownGender' class="card-subtitle mb-2 text"></h6>
          </div>
        </div>

        <div class="col-md-12 col-lg-6 d-flex align-items-stretch mb-3 mb-lg-0" data-aos="zoom-in" data-aos-delay="300">
          <div class="icon-box" style="width: 100%;">
            <h6 id='ownBirthday' class="card-subtitle mb-2 text"></h6>
            <h6 id='ownOccupation' class="card-subtitle mb-2 text"></h6>
            <h6 id='ownEmail' class="card-subtitle mb-2 text"></h6>
          </div>
        </div>
      </div>
    </div>
  </section><!-- End Hero -->


  <main id="friend">

    <!-- ======= Testimonials Section ======= -->
    <section id="testimonials" class="testimonials">
      <div class="container" data-aos="fade-up">
        <div class="section-title">
          <h2>My Friends</h2>
          <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#createFriend">Add Friend</button>
        </div>
        <div class="row mt-4 mt-4 mx-3 " id="friendList">
            <!-- Friend cards will be appended here -->
        </div>
        <div class="modal fade" id="peerWalletTransaction" aria-hidden="true" aria-labelledby="peerWalletTransactionLabel" tabindex="-1" data-bs-backdrop="true">
          <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
              <div class="modal-content">
              <div class="modal-header">
                  <h1 class="modal-title fs-5" id="peerWalletTransactionLabel">Peer to Peer Wallet Transaction</h1>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body" style = "padding: 20px">
                  <div class = "container">
                      <form>
                          <div class="form-group">
                              <label for="wallet">Your Wallet:</label>
                              <select class="form-control" v-model="sourcewallet" @change = "checkWalletsSelection">
                                  <option v-for="wallet in availableSourceWallets" :value="wallet" v-text ="wallet.WID + '. ' + wallet.CurrencyCode + ' (' + wallet.Amount + ')' ">
                                  </option>
                              </select>                            
                          </div>
                          <div class="form-group">
                              <label for="wallet">Friend:</label>
                              <select class="form-control" v-model="destinationfriend" @change="getFriendsWallets">
                                  <option v-for="friend in friends_info" :value="friend" v-text ="friend.friendee_name">
                                  </option>
                              </select>
                          </div>
                          <div v-if="destinationfriend !== null && friend_wallets_received" class="form-group" @change = "checkWalletsSelection">
                              <label for="wallet">Friend's Wallet:</label>
                              <select class="form-control" v-model="destination_friend_wallet">
                                  <option v-for="wallet in friend_wallets" :value="wallet" v-text="wallet.WID + '. ' + wallet.CurrencyCode"></option>
                              </select>
                          </div>
                          <div class="form-group">
                              <label for="amount">Amount transferred from your wallet:</label>
                              <input type="number" class="form-control" :value="wallet_amount" @input="updateAmount" step="0.1" min="0.1">
                          </div>
                          <div class="form-group">
                              <label for="exchange_rate">Exchange Rate:</label>
                              <input type="text" class="form-control" :value = exchange_rate disabled>
                          </div>
                          <button type="submit" class="btn btn-block my-3" style="background-color: #c0d0fa; color: black; width: 100%" @click="createTransaction(WalletTransaction=false, PeerTransaction = true, $event)">Submit</button>
                      </form>
                      <div v-if = "errorsFound">
                          <hr>
                          <div class="alert alert-danger" role="alert">
                              <ul>
                                  <li v-for="error in validation_errors" v-text = "error"></li>
                              </ul>
                          </div>
                      </div>
                  </div>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-outline-dark" data-bs-dismiss="modal">Close</button>
              </div>
              </div>
          </div>
        </div>
        <div class="modal fade" id="successModalTransaction" aria-hidden="true" aria-labelledby="successModalTransactionLabel" tabindex="-1" data-bs-backdrop="true">
          <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
              <div class="modal-content">
              <div class="modal-header">
                  <h1 class="modal-title fs-5" id="successModalTransactionLabel">Success!</h1>
              </div>
              <div class="modal-body d-flex flex-column align-items-center">
                  <h5>Successfully Created Transaction!</h5>
              </div>                    
              </div>
          </div>
        </div>
        <div class="modal fade" id="unsuccessfulModalTransaction" aria-hidden="true" aria-labelledby="unsuccessfulModalTransactionLabel" tabindex="-1" data-bs-backdrop="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="unsuccessfulModalTransactionLabel">Not Successful</h1>
                </div>
                <div class="modal-body d-flex flex-column align-items-center">
                    <h5>Unfortunately, we are unable to facilitate your transaction at the moment, please try again later</h5>
                </div>                    
                </div>
            </div>
        </div>
        <div class="modal fade" id="createFriend" aria-hidden="true" aria-labelledby="createFriendLabel" tabindex="-1" data-bs-backdrop="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="createFriendLabel">Add a Friend</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style = "padding: 20px">
                    <div class = "container">
                        <form>
                            <div class="form-group">
                                <label for="name">Name</label>
                                <input type="text" class="form-control" v-model="friend_name">
                              </div>
                              <div class="form-group">
                                <label for="name">Friend's User ID</label>
                                <input type="text" class="form-control" v-model="friend_id">
                              </div>
                            <button type="submit" class="btn btn-block my-3" style="background-color: #c0d0fa; color: black; width: 100%" @click="createFriend($event)">Submit</button>
                        </form>
                        <div v-if = "errorsFound">
                            <hr>
                            <div class="alert alert-danger" role="alert">
                                <ul>
                                    <li v-for="error in validation_errors" v-text = "error"></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-dark" data-bs-dismiss="modal">Close</button>
                </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="successModal" aria-hidden="true" aria-labelledby="successModalLabel" tabindex="-1" data-bs-backdrop="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="successModalLabel">Success!</h1>
                </div>
                <div class="modal-body d-flex flex-column align-items-center">
                    <h5>Successfully Created Friend!</h5>
                </div>                    
                </div>
            </div>
        </div>
        <div class="modal fade" id="unsuccessfulModal" aria-hidden="true" aria-labelledby="unsuccessfulModalLabel" tabindex="-1" data-bs-backdrop="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="unsuccessfulModalLabel">Not Successful</h1>
                </div>
                <div class="modal-body d-flex flex-column align-items-center">
                    <h5>Unfortunately, we are unable to create your friend now, please try again later.</h5>
                </div>                    
                </div>
            </div>
        </div>
      </div>
    </section><!-- End Testimonials Section -->    
  </main><!-- End #main -->
  <!-- ======= Footer ======= -->
  <footer id="footer">
    <div class="container d-md-flex py-4">
      <div class="me-md-auto text-center text-md-start">
        <div class="copyright">
          &copy; Copyright <strong><span>LendInSync</span></strong>. All Rights Reserved
        </div>
        <div class="credits">
          <!-- All the links in the footer should remain intact. -->
          <!-- You can delete the links only if you purchased the pro version. -->
          <!-- Licensing information: https://bootstrapmade.com/license/ -->
          <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/onepage-multipurpose-bootstrap-template/ -->
          Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
        </div>
      </div>
    </div>
  </footer><!-- End Footer -->

  <div id="preloader"></div>
  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      await checkLocalStorageAndRedirect();
  });

  async function checkLocalStorageAndRedirect() {
      const username = localStorage.getItem('username');
      if (!username) {
          window.location.href = '/';
      }
      // ... any other async operations
  }
  </script>
  <!-- Vendor JS Files -->
  <script src="/DBEAT1/lendinsync/assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="/DBEAT1/lendinsync/assets/vendor/aos/aos.js"></script>
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
  <script src="/DBEAT1/lendinsync/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/DBEAT1/lendinsync/assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="/DBEAT1/lendinsync/assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="/DBEAT1/lendinsync/assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="/DBEAT1/lendinsync/assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="/DBEAT1/lendinsync/assets/js/main.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const username = localStorage.getItem('username');
        const pin = localStorage.getItem('pin');
        const friends_url = `http://127.0.0.1:8895/friends/${username}`;
        fetch(friends_url)
            .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
        }
        return response.json();
    })
            .then(data => {
                console.log(data); // Log the data to check if it's retrieved successfully

                // Extract the 'friends' array from the data
                const friendsData = data.data.friends;
                console.log('hi', friendsData);

                // Select the container where you want to append the data
                const friendsContainer = document.querySelector('#friendList');

                friendsData.forEach(friend => {
                    const friendCard = document.createElement('div');
                    friendCard.classList.add('col-md-4'); // Adjust the column size as needed
                    friendCard.innerHTML = `
                        <div class="card mb-4">
                            <div class="card-body">
                                <h5 class="card-title">${friend.friendee_name}</h5>
                                <h6 class="card-subtitle mb-2 text-muted">CustomerID: ${friend.friendee_id}</h6>
                                <button class="btn btn-light"  @click="openModal('${JSON.stringify(friend)}')" data-bs-toggle="modal" data-bs-target="#peerWalletTransaction">Transfer</button>
                            </div>
                        </div>
                    `;

                    friendsContainer.appendChild(friendCard);
                });
            })
            .catch(error => {
                console.error('An error occurred:', error);
            });

        const url = `http://tbankonline.com/SMUtBank_API/Gateway?Header={"serviceName":"getCustomerDetails","userID":"${username}","PIN":"${pin}","OTP":"999999"}`;

        fetch(url)
            .then(response => response.json())
            .then(data => {
                console.log(data);

                // Select the HTML elements
                const nameElement = document.querySelector('#ownName');
                const customerIDElement = document.querySelector('#ownCustomerID');
                const nationalityElement = document.querySelector('#ownNationality');
                const genderElement = document.querySelector('#ownGender');
                const birthdayElement = document.querySelector('#ownBirthday');
                const occupationElement = document.querySelector('#ownOccupation');
                const emailElement = document.querySelector('#ownEmail');
                const phoneElement = document.querySelector('#ownPhoneNo');
                // const interestsElement = document.querySelectorAll('.card-text')[2];
                const username = localStorage.getItem('username');
                // Update the content of the HTML elements
                nameElement.textContent = data.Content.ServiceResponse.CDMCustomer.givenName + ' ' + data.Content.ServiceResponse.CDMCustomer.familyName;
                customerIDElement.textContent = 'Customer ID: ' + username
                nationalityElement.textContent = 'Nationality: ' + data.Content.ServiceResponse.CDMCustomer.profile.nationality
                genderElement.textContent = 'Gender: ' + data.Content.ServiceResponse.CDMCustomer.profile.gender
                birthdayElement.textContent = 'Birthday: ' + data.Content.ServiceResponse.CDMCustomer.dateOfBirth
                occupationElement.textContent = 'Occupation: ' + data.Content.ServiceResponse.CDMCustomer.profile.occupation
                emailElement.textContent = 'Email: ' + data.Content.ServiceResponse.CDMCustomer.profile.email;
                phoneElement.textContent = 'Mobile Number: ' + data.Content.ServiceResponse.CDMCustomer.cellphone.phoneNumber;
                // emailElement.textContent = email;
                // phoneElement.textContent = `Phone: ${phone}`;
                // addressElement.textContent = `Address: ${address}`;
                // interestsElement.textContent = `Interests: ${interests}`;
                })
            .catch(error => console.error(error));
            const customer_id = username;
            const get_wallets_by_customerid = "http://127.0.0.1:7000/wallet/" + customer_id;
            const get_wallets = "http://127.0.0.1:7000/wallet/"
            const create_wallet = "http://127.0.0.1:7000/wallet";
            const create_transaction = "http://127.0.0.1:6100/transfer";
            const get_friends_by_customerid = "http://localhost:8895/friends/" + customer_id;
            const create_peer_transaction = "http://127.0.0.1:6100/peer_transfer";
            const create_friend = "http://localhost:8895/submit_friend";
            const friend = Vue.createApp({
            data() {
                return {
                customer_wallets: [],
                customer_transactions: [],
                wallets_received: false,
                transactions_received: false,
                message: '', // Define a message property for error handling
                data_received: false,
                currency_info: [],
                selectedCurrency: "",
                customer_id: customer_id,
                wallet_amount: 0,
                exchange_rate: 0,
                sourcewallet: null,
                availableDestinationWallets: [],
                availableSourceWallets: [],
                validation_errors: [],
                errorsFound: false,
                friends_info: [],
                friends_received: false,
                destinationfriend: null,
                friend_wallets: [],
                friend_wallets_received: false,
                destination_friend_wallet: null,
                friend_name: '',
                friend_id: '',
                };
            },
            methods: {
                openModal(friend) {
                    console.log("friend")
                    console.log(friend)
                    this.errorsFound = false;
                    this.sourcewallet = null;
                    this.wallet_amount = 0; 
                    this.selectedCurrency = "";
                    this.validation_errors = [];
                    this.destinationfriend = friend; // Set the selected friend
                },
                async get_wallets() {
                try {
                    const response = await fetch(get_wallets_by_customerid);
                    const data = await response.json();
                    if (data.code === 404) {
                    this.message = data.message;
                    } else {
                    this.customer_wallets = data.data.wallet; 
                    this.wallets_received = true;
                    this.availableSourceWallets = this.customer_wallets;
                    console.log(this.availableSourceWallets)
                    this.availableDestinationWallets = this.customer_wallets;
                    this.checkDataReceived();
                    }
                } catch (error) {
                    console.error('Error fetching wallets:', error);
                    this.message = 'Error fetching wallet data: ' + error;
                }
                },
                async get_friends() {
                try {
                    const response = await fetch(get_friends_by_customerid);
                    const data = await response.json();

                    if (data.code === 404) {
                    this.message = data.message;
                    } else {
                    this.friends_info = data.data.friends;
                    this.friends_received = true;
                    this.checkDataReceived();
                    }
                } catch (error) {
                    this.message = 'Error fetching transaction data: ' + error;
                }
                },
                checkDataReceived() {
                if (this.wallets_received && this.friends_received) {
                    this.data_received = true;
                }
                },
                async getCurrencyCodes(){
                    const response = await fetch('http://tbankonline.com/SMUtBank_API/Gateway?Header={"serviceName": "getCurrencyList", "userID": "", "PIN": "", "OTP": ""}&Content={"baseCurrency": "", "quoteCurrency": ""}');
                    const data = await response.json();
                    this.currency_info = data.Content.ServiceResponse.CurrencyList.Currency;
                },
                updateSourceAndCheck() {
                this.updateSourceWallets();
                this.checkWalletsSelection();
                },
                checkWalletsSelection() {
                    console.log("checking")
                    if (this.sourcewallet && this.destinationwallet) {
                        console.log("checking!")
                        this.getWalletExchange();
                    }
                    else if (this.sourcewallet && this.destination_friend_wallet){
                        this.getWalletExchange();
                    }
                },
                async getWalletExchange() {
                    console.log("here");
                    console.log(this.sourcewallet);
                    console.log(this.destinationwallet);
                    if (this.sourcewallet && this.destinationwallet) {
                        console.log("Both wallets have been selected")
                        const response = await fetch(`http://tbankonline.com/SMUtBank_API/Gateway?Header={"serviceName": "getExchangeRate", "userID": "", "PIN": "", "OTP": ""}&Content={"baseCurrency": "${this.sourcewallet.CurrencyCode}", "quoteCurrency": "${this.destinationwallet.CurrencyCode}"}`);
                        const data = await response.json();
                        console.log(data)
                        this.exchange_rate = data.Content.ServiceResponse["FX_SpotRate_Read-Response"]["Rate"];
                        console.log(this.exchange_rate);
                    } 
                    else if (this.sourcewallet && this.destination_friend_wallet){
                        console.log("Both wallets have been selected");
                        const response = await fetch(`http://tbankonline.com/SMUtBank_API/Gateway?Header={"serviceName": "getExchangeRate", "userID": "", "PIN": "", "OTP": ""}&Content={"baseCurrency": "${this.sourcewallet.CurrencyCode}", "quoteCurrency": "${this.destination_friend_wallet.CurrencyCode}"}`);
                        const data = await response.json();
                        this.exchange_rate = data.Content.ServiceResponse["FX_SpotRate_Read-Response"]["Rate"];
                    }
                    else {
                        console.log("Both source and destination wallets need to be chosen.");
                    }
                },    
                async createTransaction(WalletTransaction, PeerTransaction, event) {
                    event.preventDefault();
                    this.validation_errors = []
                    this.errorsFound = false;
                    if (PeerTransaction == true){
                        if (this.sourcewallet == null) {  
                        this.validation_errors.push("Please select a source wallet");
                        }
                        if (this.destination_friend_wallet == null) {
                        this.validation_errors.push("Please select a destination wallet");
                        }
                        if (this.sourcewallet != null && this.wallet_amount > this.sourcewallet.Amount) {
                        this.validation_errors.push("Insufficient funds in source wallet");
                        }
                        if (this.wallet_amount <= 0 || this.wallet_amount == "") {
                        this.validation_errors.push("Amount must be greater than 0");
                        }
                        if (this.validation_errors.length > 0) {
                        this.errorsFound = true
                        return;
                        }
                        else {
                            this.peerWalletTransaction()
                        }
                    }
                    },
                async peerWalletTransaction(){
                    const currentDate = new Date();  // Your new Date() object
                    // Format the date as a string in the desired MySQL DATETIME format
                    const formattedDate = currentDate.toISOString().slice(0, 19).replace('T', ' ');
                    const jsonData = JSON.stringify({
                        "SourceWallet": this.sourcewallet.WID,
                        "DestinationWallet": this.destination_friend_wallet.WID,
                        "CustomerId": this.customer_id,
                        "ExchangeRate": this.exchange_rate,
                        "TimeStamp": formattedDate,
                        "AmountTransferred": this.wallet_amount
                        });
                        const url = create_peer_transaction;
                        const postMethod = {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: jsonData
                    };
                    try {
                        const response = await fetch(url, postMethod);
                        const data = await response.json();
                        console.log(data)
                        switch (data.code) {
                            case 201:
                                // Handle success case
                                // Close the createWalletModal
                                $('#peerWalletTransaction').modal('hide');
                                // Show success modal
                                $('#successModalTransaction').modal('show');
                                // Reload page after a delay (you can change the delay as needed)
                                setTimeout(() => {
                                    window.location.reload();
                                }, 1000); // Example: Reload after 1 second (1000 milliseconds)
                                break;
                            case 500:
                                this.message = data.message;
                                // Close the createWalletModal
                                $('#peerWalletTransaction').modal('hide');
                                // Show unsuccessful modal
                                $('#unsuccessfulModalTransaction').modal('show');
                                // Reload page after a delay (you can change the delay as needed)
                                setTimeout(() => {
                                    window.location.reload();
                                }, 2000); // Example: Reload after 1 seconds (1000 milliseconds)
                                break;
                            default:
                                throw `${data.code}: ${data.message}`;
                        }
                    } 
                    catch (error) {
                        console.error('Error:', error);
                        // Handle other errors or display a general error message
                    }
                },
                updateDestinationWallets() {
                if (this.sourcewallet) {
                    this.availableDestinationWallets = this.customer_wallets.filter(wallet => wallet.WID !== this.sourcewallet.WID);
                } else {
                    this.availableDestinationWallets = this.customer_wallets;
                }
                },
                updateSourceWallets() {
                    if (this.destinationwallet) {
                        this.availableSourceWallets = this.customer_wallets.filter(wallet => wallet.WID !== this.destinationwallet.WID);
                    } else {
                        this.availableSourceWallets = this.customer_wallets;
                    }
                },
                updateAmount(event) {
                // Update the wallet_amount when the input changes
                const value = parseFloat(event.target.value);
                this.wallet_amount = isNaN(value) || value < 0 ? 0.1 : value;
                },
                async getFriendsWallets(){
                    this.friend_wallets_received = false;
                    try {
                    const friend_wallet_url = get_wallets + this.destinationfriend.friendee_id;
                    const response = await fetch(friend_wallet_url);
                    const data = await response.json();

                    if (data.code === 404) {
                    this.message = data.message;
                    } else {
                    this.friend_wallets = data.data.wallet; 
                    this.friend_wallets_received = true;
                    }
                } catch (error) {
                    console.error('Error fetching wallets:', error);
                    this.message = 'Error fetching wallet data: ' + error;
                }
                },
                async createFriend(event) {
                    event.preventDefault();
                    this.validation_errors = []
                    if (this.friend_name == "") {   
                        this.validation_errors.push("Please enter a name");
                    }
                    if (this.friend_id == "") {
                        this.validation_errors.push("Please enter a friend's user ID"); 
                    }
                    if (this.validation_errors.length > 0) {
                        this.errorsFound = true
                        return;
                    }
                    else {
                        this.validation_errors = [];
                        this.errorsFound = false;
                        const jsonData = JSON.stringify({
                        friend_id: this.customer_id,
                        friendee_id: this.friend_id,
                        friendee_name: this.friend_name
                        });
                        const url = create_friend+ "/" + this.customer_id;
                        const postMethod = {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: jsonData
                        };
                        try {
                            const response = await fetch(url, postMethod);
                            const data = await response.json();
                    
                            switch (data.code) {
                                case 201:
                                    // Close the createFriend Modal
                                    $('#createFriend').modal('hide');
                                    // Show success modal
                                    $('#successModal').modal('show');
                                    // Reload page after a delay (you can change the delay as needed)
                                    setTimeout(() => {
                                        window.location.reload();
                                    }, 1000); // Example: Reload after 1 second (1000 milliseconds)
                                    break;
                                case 500:
                                    this.message = data.message;
                                    // Close the createFriend Modal
                                    $('#createFriend').modal('hide');
                                    // Show unsuccessful modal
                                    $('#unsuccessfulModal').modal('show');
                                    // Reload page after a delay (you can change the delay as needed)
                                    setTimeout(() => {
                                        window.location.reload();
                                    }, 1000); // Example: Reload after 1 seconds (1000 milliseconds)
                                    break;
                                default:
                                    throw `${data.code}: ${data.message}`;
                            }
                        } catch (error) {
                            console.error('Error');
                        }
                    }
                },
            },
            mounted() {
                this.get_wallets();
                this.getCurrencyCodes();
                this.get_friends();
            },
            });
            const vm = friend.mount('#friend');
        });
    
    // Get the form
    let form = document.getElementById('myForm');

    // Get the username from localStorage
    let username = localStorage.getItem('username');

    // Set the form's action attribute
    form.action = `http://localhost:8895/submit_friend/${username}`;

    form.addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent the form from submitting normally

    let formData = new FormData(event.target);

    fetch(form.action, {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        console.log(data);
        closeForm(); // Close the form
        location.reload(); // Reload the page
    })
    .catch(error => console.error(error));
    });
    </script>
    <script>
        function openForm() {
            document.getElementById("myForm").style.display = "block";
            document.getElementById("backdrop").style.display = "block";
        }

        function closeForm() {
            document.getElementById("myForm").style.display = "none";
            document.getElementById("backdrop").style.display = "none";
        }
    </script>
     <script>
      function logout() {
     localStorage.clear();
     window.location.href = "/";
 }
 
   </script>
</body>

</html>